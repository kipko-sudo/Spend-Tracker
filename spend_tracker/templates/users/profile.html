{% extends 'base.html' %}

{% block title %}Profile - SpendWise{% endblock %}

{% block page_title %}Profile{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <div class="grid-col-4">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Account Information</h3>
            </div>
            <div class="card-body">
                <div class="profile-info">
                    <div class="profile-avatar mb-4 text-center">
                        <div class="avatar-circle">
                            <i class="fas fa-user fa-3x"></i>
                        </div>
                        <h4 class="mt-3">{{ user.username }}</h4>
                        <p class="text-muted">{{ user.email }}</p>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-item">
                            <div class="detail-label">Account Type</div>
                            <div class="detail-value">{{ user.get_user_type_display }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Currency</div>
                            <div class="detail-value">{{ user.get_currency_display }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Member Since</div>
                            <div class="detail-value">{{ user.date_joined|date:"F d, Y" }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <a href="#" class="btn btn-outline w-100">
                    <i class="fas fa-key"></i> Change Password
                </a>
            </div>
        </div>
        
        <!-- Financial Summary Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h3 class="card-title">Financial Summary</h3>
            </div>
            <div class="card-body">
                <div class="summary-item">
                    <div class="summary-label">Month Income</div>
                    <div class="summary-value text-success">{{ currency_symbol }}{{ month_income|floatformat:2 }}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Month Expenses</div>
                    <div class="summary-value text-danger">{{ currency_symbol }}{{ month_expenses|floatformat:2 }}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Month Savings</div>
                    <div class="summary-value {% if month_savings >= 0 %}text-success{% else %}text-danger{% endif %}">
                        {{ currency_symbol }}{{ month_savings|floatformat:2 }}
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Total Transactions</div>
                    <div class="summary-value">{{ total_transactions }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid-col-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Edit Profile</h3>
            </div>
            <div class="card-body">
                <form method="post" class="form-container">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="{{ profile_form.first_name.id_for_label }}" class="form-label">First Name</label>
                        {{ profile_form.first_name.errors }}
                        <input type="text" name="{{ profile_form.first_name.name }}" id="{{ profile_form.first_name.id_for_label }}" class="form-control" value="{{ profile_form.first_name.value|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ profile_form.last_name.id_for_label }}" class="form-label">Last Name</label>
                        {{ profile_form.last_name.errors }}
                        <input type="text" name="{{ profile_form.last_name.name }}" id="{{ profile_form.last_name.id_for_label }}" class="form-control" value="{{ profile_form.last_name.value|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ profile_form.email.id_for_label }}" class="form-label">Email</label>
                        {{ profile_form.email.errors }}
                        <input type="email" name="{{ profile_form.email.name }}" id="{{ profile_form.email.id_for_label }}" class="form-control" value="{{ profile_form.email.value|default:'' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ profile_form.currency.id_for_label }}" class="form-label">Currency</label>
                        {{ profile_form.currency.errors }}
                        {{ profile_form.currency }}
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            {{ profile_form.convert_currency.errors }}
                            <input type="checkbox" name="{{ profile_form.convert_currency.name }}" id="{{ profile_form.convert_currency.id_for_label }}" class="form-check-input">
                            <label class="form-check-label" for="{{ profile_form.convert_currency.id_for_label }}">
                                Convert existing amounts to new currency based on market rates
                            </label>
                            <div class="form-text">If unchecked, only the currency symbol will change without converting amounts.</div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end mt-4">
                        <button type="submit" class="btn btn-primary">Update Profile</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h3 class="card-title">Preferences</h3>
            </div>
            <div class="card-body">
                <form method="post" class="form-container">
                    {% csrf_token %}
                    <input type="hidden" name="update_preferences" value="1">
                    
                    <div class="form-group">
                        <div class="form-check">
                            {{ pref_form.receive_weekly_reports.errors }}
                            <input type="checkbox" name="{{ pref_form.receive_weekly_reports.name }}" id="{{ pref_form.receive_weekly_reports.id_for_label }}" class="form-check-input" {% if pref_form.receive_weekly_reports.value %}checked{% endif %}>
                            <label class="form-check-label" for="{{ pref_form.receive_weekly_reports.id_for_label }}">
                                Receive Weekly Reports
                            </label>
                            <div class="form-text">Get a weekly summary of your spending and saving habits via email.</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            {{ pref_form.receive_budget_alerts.errors }}
                            <input type="checkbox" name="{{ pref_form.receive_budget_alerts.name }}" id="{{ pref_form.receive_budget_alerts.id_for_label }}" class="form-check-input" {% if pref_form.receive_budget_alerts.value %}checked{% endif %}>
                            <label class="form-check-label" for="{{ pref_form.receive_budget_alerts.id_for_label }}">
                                Receive Budget Alerts
                            </label>
                            <div class="form-text">Get notified when you're approaching or exceeding your budget limits.</div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-end mt-4">
                        <button type="submit" class="btn btn-primary">Save Preferences</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<style>
    .avatar-circle {
        width: 100px;
        height: 100px;
        background-color: var(--primary-light);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        margin: 0 auto;
    }
    
    .detail-item {
        display: flex;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .detail-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .detail-label {
        width: 40%;
        font-weight: 500;
        color: var(--text-light);
    }
    
    .detail-value {
        width: 60%;
        font-weight: 500;
    }
    
    .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .summary-label {
        font-weight: 500;
        color: var(--text-light);
    }
    
    .summary-value {
        font-weight: 600;
    }
    
    /* Responsive fixes for mobile */
    @media (max-width: 768px) {
        .export-options {
            flex-direction: column;
            gap: 10px;
        }
        
        .export-options .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}